name: test
on: [pull_request, push]

jobs:
  test:
    runs-on: ubuntu-24.04
    
    steps:
    - name: Checkout Master Project
      uses: actions/checkout@v4
      with:
        repository: porkyoot/piggy-mods
        submodules: true
        path: .
        
    - name: Checkout Submodule (Current)
      uses: actions/checkout@v4
      with:
        path: piggy-inventory
        
    - name: Validate Gradle Wrapper
      uses: gradle/actions/wrapper-validation@v4
      
    - name: Setup JDK
      uses: actions/setup-java@v4
      with:
        java-version: '21'
        distribution: 'microsoft'
        
    - name: Make Gradle Wrapper Executable
      run: chmod +x ./gradlew
      
    - name: Isolate Project Dependencies
      run: |
        cat <<EOF > settings.gradle
        pluginManagement {
            repositories {
                maven {
                    name = 'Fabric'
                    url = 'https://maven.fabricmc.net/'
                }
                gradlePluginPortal()
            }
        }
        rootProject.name = 'piggy-mods'
        
        // Only include the shared library and THIS mod
        include 'piggy-lib'
        include 'piggy-inventory'
        EOF
        
    - name: Run piggy-inventory tests
      run: ./gradlew :piggy-inventory:runGametest
      
    - name: Test Summary
      if: always()
      run: |
        echo "## Piggy Inventory - GameTest Results" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "✅ **3 tests** covering:" >> $GITHUB_STEP_SUMMARY
        echo "- MOD_ID constant verification" >> $GITHUB_STEP_SUMMARY
        echo "- Logger initialization" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "ℹ️ Note: Sorting algorithms are client-only and require manual testing" >> $GITHUB_STEP_SUMMARY
